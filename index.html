<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App de Ubicación</title>
<style>
    /* Estilos CSS básicos */
    .hidden {
        display: none;
    }
</style>
</head>
<body>

<!-- Página Principal -->
<div id="paginaPrincipal">
    <button id="btnBuscarSitio">Buscar sitio</button>
    <button id="btnIndicarSitio">Indicar sitio</button>
</div>

<!-- Contenido para Buscar Sitio -->
<div id="contenidoBuscarSitio" class="hidden">
    <!-- Contenido que aparece al hacer clic en "Buscar sitio" -->
    <input type="text" id="inputBusqueda" placeholder="Buscar ubicación...">
    <ul id="listaUbicacionesBusqueda"></ul>
    <button id="btnVolverBuscar">Volver</button>
</div>

<!-- Contenido para Indicar Sitio -->
<div id="contenidoIndicarSitio" class="hidden">
    <button id="btnIndicar">Indicar</button>
    <button id="btnVolverIndicar">Volver</button>
    <ul id="listaDirecciones"></ul>
</div>

<script>
    var ubicacionesDisponibles = [];

    // Obtener ubicaciones almacenadas en localStorage al cargar la página
    if (localStorage.getItem('ubicacionesDisponibles')) {
        ubicacionesDisponibles = JSON.parse(localStorage.getItem('ubicacionesDisponibles'));
        mostrarUbicacionesGuardadas();
    }

    // Función para mostrar las ubicaciones almacenadas
    function mostrarUbicacionesGuardadas() {
        var listaDirecciones = document.getElementById("listaDirecciones");
        listaDirecciones.innerHTML = '';

        ubicacionesDisponibles.forEach(function(ubicacion) {
            var nuevaDireccion = document.createElement("li");
            nuevaDireccion.textContent = ubicacion.address;
            nuevaDireccion.setAttribute("data-latitud", ubicacion.latitude);
            nuevaDireccion.setAttribute("data-longitud", ubicacion.longitude);
            listaDirecciones.appendChild(nuevaDireccion);
        });
    }

    // Función para guardar las ubicaciones en localStorage
    function guardarUbicacionesEnLocalStorage() {
        localStorage.setItem('ubicacionesDisponibles', JSON.stringify(ubicacionesDisponibles));
    }

    // Función para mostrar el contenido de Buscar Sitio y ocultar la Página Principal
    document.getElementById("btnBuscarSitio").addEventListener("click", function() {
        document.getElementById("paginaPrincipal").classList.add("hidden");
        document.getElementById("contenidoBuscarSitio").classList.remove("hidden");
    });

    // Función para volver a la Página Principal desde el contenido de Buscar Sitio
    document.getElementById("btnVolverBuscar").addEventListener("click", function() {
        document.getElementById("contenidoBuscarSitio").classList.add("hidden");
        document.getElementById("paginaPrincipal").classList.remove("hidden");
    });

    // Función para mostrar el contenido de Indicar Sitio y ocultar la Página Principal
    document.getElementById("btnIndicarSitio").addEventListener("click", function() {
        document.getElementById("paginaPrincipal").classList.add("hidden");
        document.getElementById("contenidoIndicarSitio").classList.remove("hidden");
    });

    // Función para volver a la Página Principal desde el contenido de Indicar Sitio
    document.getElementById("btnVolverIndicar").addEventListener("click", function() {
        document.getElementById("contenidoIndicarSitio").classList.add("hidden");
        document.getElementById("paginaPrincipal").classList.remove("hidden");
    });

    // Función para obtener la ubicación del usuario y mostrar el nombre de la dirección
    document.getElementById("btnIndicar").addEventListener("click", function() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;
                
                // Llamada a la API de geocodificación inversa de OpenStreetMap
                fetch('https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=' + latitude + '&lon=' + longitude)
                    .then(response => response.json())
                    .then(data => {
                        var address = data.display_name; // Obtener el nombre de la dirección
                        ubicacionesDisponibles.push({ address: address, latitude: latitude, longitude: longitude });
                        guardarUbicacionesEnLocalStorage(); // Guardar en localStorage
                        mostrarUbicacionesGuardadas(); // Mostrar la ubicación en la lista
                    })
                    .catch(error => {
                        console.error('Error al obtener la dirección:', error);
                    });
            });
        } else {
            alert("Geolocalización no soportada en este navegador.");
        }
    });

    // Función para filtrar la lista de ubicaciones según la entrada del usuario
    document.getElementById("inputBusqueda").addEventListener("input", function() {
        var input = this.value.trim().toLowerCase();
        var listaUbicacionesBusqueda = document.getElementById("listaUbicacionesBusqueda");
        listaUbicacionesBusqueda.innerHTML = '';

        ubicacionesDisponibles.forEach(function(ubicacion) {
            var address = ubicacion.address;

            if (address.toLowerCase().includes(input)) {
                var nuevaUbicacion = document.createElement("li");
                nuevaUbicacion.textContent = address;
                nuevaUbicacion.setAttribute("data-latitud", ubicacion.latitude);
                nuevaUbicacion.setAttribute("data-longitud", ubicacion.longitude);
                listaUbicacionesBusqueda.appendChild(nuevaUbicacion);
            }
        });
    });

    // Al hacer clic en una ubicación encontrada en la búsqueda, llenar el cuadro de búsqueda en el contenido "Buscar sitio" con la ubicación seleccionada
    document.getElementById("listaUbicacionesBusqueda").addEventListener("click", function(event) {
        var target = event.target;
        var latitud = target.getAttribute("data-latitud");
        var longitud = target.getAttribute("data-longitud");
        document.getElementById("inputBusqueda").value = "Latitud: " + latitud + ", Longitud: " + longitud;
    });
</script>

</body>
</html>
